# TypeScript setup

This repo uses **TypeScript project references** (build mode) so the editor and
CLI typechecking agree without forcing every file into a single TS
"environment".

## The three environments

We have **three** distinct TypeScript environments, each with its own
`tsconfig`.

### Client

- **Config**: `types/tsconfig-client.json`
- **Files**: `client/**/*.ts`, `client/**/*.tsx`
- **Environment**: browser (`DOM`, `DOM.Iterable`) + JSX (`remix/component`)

### Tools

- **Config**: `types/tsconfig-tools.json`
- **Files**:
  - `vite.config.ts`
  - `playwright.config.ts`
  - `wrangler-env.ts`
  - `cli.ts`
  - `docs/post-download.ts`
  - `mcp/mcp-server-e2e.test.ts`
- **Environment**: Node/Bun (scripts, configs, tests)

### Worker

- **Config**: `types/tsconfig-worker.json`
- **Files**:
  - `worker/**/*.ts`
  - `server/**/*.ts`
  - `mcp/**/*.ts`
  - `types/env.d.ts`, `types/env-schema.ts`
  - generated `types/worker-configuration.d.ts` (via `bun run generate-types`)
- **Environment**: Cloudflare Workers (`WebWorker`, `WebWorker.Iterable`)

## Solution config (project references)

The root `tsconfig.json` is the **solution** file:

- It has no `include`.
- It references the three environment configs above.

The CLI `typecheck` runs:

- `tsc -b --noEmit` (build mode, using the root `tsconfig.json`)

## Generated worker types (`types/worker-configuration.d.ts`)

`types/worker-configuration.d.ts` is **generated** and must never be edited by
hand.

- To update it, run `bun run generate-types`.
- `bun run generate-types` runs `wrangler types` and then normalizes a small
  portion of the output so the file uses our repo-root `#...` import aliases.
- If you see this file change in a PR, it should be explainable by changes to
  Worker bindings/config (for example `wrangler.jsonc`) or by re-running the
  generation script.

## Common gotchas

- **Missing editor types** usually means the file isn't included by any of the
  three environment configs. Add it to the appropriate `tsconfig.*.json`.
- **Worker types** depend on the generated `types/worker-configuration.d.ts`;
  run `bun run generate-types` if bindings/types drift.
