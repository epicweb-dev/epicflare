# Data storage

This project uses three Cloudflare storage systems for different purposes.

## Postgres (`DATABASE_URL`)

Relational app data lives in Postgres.

Current schema is defined by Drizzle schema + migrations:

- Table definitions: `src/db/schema.ts`
- SQL migrations: `src/db/migrations/` (generated by `drizzle-kit`)
- Migration runner: `scripts/migrate.ts`

App access pattern:

- SQL helpers in `src/db/client.ts` provide simple wrappers (`queryFirst`,
  `queryAll`, `exec`) around Drizzle.
- app handlers (for example `server/handlers/auth.ts`) use these helpers for
  database calls.

## KV (`OAUTH_KV`)

OAuth provider state is stored in KV through the
`@cloudflare/workers-oauth-provider` integration.

- Binding is configured in `wrangler.jsonc`
- This supports OAuth client and token flows without custom storage code in the
  app handlers

## Durable Objects (`MCP_OBJECT`)

MCP server runtime state is hosted via a Durable Object class (`MCP`) in
`mcp/index.ts`, exposed through the `/mcp` route.

- The Worker forwards authorized MCP requests to `MCP.serve(...).fetch`
- Durable Objects provide a stateful execution model for MCP operations

## Configuration reference

Bindings are configured per environment in `wrangler.jsonc`:

- `DATABASE_URL` (Postgres connection string; stored as a Worker secret)
- `OAUTH_KV` (KV)
- `MCP_OBJECT` (Durable Objects)
- `ASSETS` (static assets bucket)
